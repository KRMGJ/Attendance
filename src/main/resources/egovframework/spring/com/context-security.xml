<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:security="http://www.springframework.org/schema/security"
	xmlns:egov-security="http://maven.egovframe.go.kr/schema/egov-security"
	xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/security http://www.springframework.org/schema/security/spring-security.xsd
		http://maven.egovframe.go.kr/schema/egov-security http://maven.egovframe.go.kr/schema/egov-security/egov-security-4.1.0.xsd">

	<security:http pattern="/css/**" security="none" />
	<security:http pattern="/html/**" security="none" />
	<security:http pattern="/images/**" security="none" />
	<security:http pattern="/js/**" security="none" />
	<security:http pattern="/resource/**" security="none" />
	<security:http pattern="\A/WEB-INF/jsp/.*\Z" request-matcher="regex" security="none" />

	<security:authentication-manager>
		<security:authentication-provider>
			<security:password-encoder ref="passwordEncoder" />
			<security:jdbc-user-service data-source-ref="egov.dataSource"
				users-by-username-query="
		        SELECT USERNAME, PASSWORD, CASE WHEN ENABLED=1 THEN 1 ELSE 0 END
		        FROM USERS WHERE USERNAME = ?"
				authorities-by-username-query="
        		SELECT USERNAME, AUTHORITY FROM AUTHORITIES WHERE USERNAME = ?" 
        	/>
		</security:authentication-provider>
	</security:authentication-manager>

	<security:http use-expressions="true">
		<security:csrf disabled="true" />
		<security:intercept-url pattern="/login.do" access="permitAll" />
		<security:intercept-url pattern="/signup.do" access="permitAll" />
		<!-- <security:intercept-url pattern="/**" access="isAuthenticated()" /> -->
		<security:form-login login-page="/login.do"
							 login-processing-url="/login.do" 
							 default-target-url="/"
							 authentication-failure-url="/login.do?error=1"
							 username-parameter="username" 
							 password-parameter="password" />
		<security:logout logout-url="/logout.do"
						 logout-success-url="/login.do?logout=1"
						 invalidate-session="true" />
		<security:session-management invalid-session-url="/login.do?expired=1">
			<security:concurrency-control max-sessions="1" error-if-maximum-exceeded="false" />
		</security:session-management>
	</security:http>

	<!-- BCrypt -->
	<bean id="passwordEncoder" class="org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder" />

	<!-- URL에 세미콜론(semicolon)허용 여부(기본값/false) -->
	<bean id="egovStrictHttpFirewall"
		class="org.springframework.security.web.firewall.StrictHttpFirewall">
		<property name="allowSemicolon" value="true" />
	</bean>
	<security:http-firewall
		ref="egovStrictHttpFirewall" />

</beans>
